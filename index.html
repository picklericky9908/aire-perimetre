<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة تعليمية للأشكال ثلاثية الأبعاد</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            direction: rtl;
            text-align: right;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .shape-button, .feature-button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .shape-button:hover, .feature-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .shape-button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-color: rgba(255, 255, 255, 0.9);
        }
        
        .feature-button {
            background: rgba(0, 150, 255, 0.3);
            border-color: rgba(0, 150, 255, 0.5);
        }
        
        .feature-button:hover {
            background: rgba(0, 150, 255, 0.5);
        }
        
        .feature-button.active {
            background: rgba(0, 150, 255, 0.8);
            color: white;
            border-color: rgba(0, 150, 255, 0.8);
        }
        
        #canvas-container {
            width: 100%;
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }
        
        .info-panel {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .shape-info {
            display: none;
            font-size: 18px;
            line-height: 1.6;
        }
        
        .shape-info.active {
            display: block;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .faces { background: rgba(128, 128, 128, 0.5); border: 2px solid #808080; }
        .edges { background: #000000; }
        .vertices { background: #ff0000; }
        
        .math-formulas {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 16px;
        }
        
        .math-formulas p {
            margin: 8px 0;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .shape-button, .feature-button { padding: 10px 20px; font-size: 14px; }
            #canvas-container { height: 400px; }
            .legend { gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>أداة تعليمية للأشكال ثلاثية الأبعاد</h1>
        
        <div class="controls">
            <button class="shape-button active" data-shape="cube">مكعب</button>
            <button class="shape-button" data-shape="box">متوازي مستطيلات</button>
            <button class="shape-button" data-shape="cylinder">أسطوانة</button>
            <button class="shape-button" data-shape="cone">مخروط</button>
        </div>
        
        <div class="controls">
            <button class="feature-button" id="fill-water">ملء بالماء</button>
            <button class="feature-button" id="show-perimeter">إظهار المحيط الكلي</button>
            <button class="feature-button" id="reset-view">إعادة تعيين</button>
        </div>
        
        <div id="canvas-container"></div>
        
        <div class="info-panel">
            <div class="shape-info active" id="cube-info">
                <h3>المكعب</h3>
                <p>المكعب شكل ثلاثي الأبعاد له 6 أوجه مربعة متساوية، 12 حافة و 8 رؤوس</p>
                <p><strong>الأوجه:</strong> 6 | <strong>الحواف:</strong> 12 | <strong>الرؤوس:</strong> 8</p>
                <div class="math-formulas">
                    <p><strong>الحجم:</strong> 8 وحدات مكعبة</p>
                    <p><strong>قانون الحجم:</strong> الحجم = الطول³ = 2³ = 8</p>
                    <p><strong>المساحة الكلية:</strong> 24 وحدة مربعة</p>
                    <p><strong>قانون المساحة:</strong> المساحة = 6 × الطول² = 6 × 2² = 24</p>
                    <p><strong>محيط القاعدة:</strong> 8 وحدات</p>
                    <p><strong>قانون المحيط:</strong> المحيط = 4 × الطول = 4 × 2 = 8</p>
                </div>
            </div>
            
            <div class="shape-info" id="box-info">
                <h3>متوازي المستطيلات</h3>
                <p>متوازي المستطيلات شكل ثلاثي الأبعاد له 6 أوجه مستطيلة، 12 حافة و 8 رؤوس</p>
                <p><strong>الأوجه:</strong> 6 | <strong>الحواف:</strong> 12 | <strong>الرؤوس:</strong> 8</p>
                <div class="math-formulas">
                    <p><strong>الحجم:</strong> 9 وحدات مكعبة</p>
                    <p><strong>قانون الحجم:</strong> الحجم = الطول × العرض × الارتفاع = 3 × 2 × 1.5 = 9</p>
                    <p><strong>المساحة الكلية:</strong> 27 وحدة مربعة</p>
                    <p><strong>قانون المساحة:</strong> المساحة = 2(طول×عرض + طول×ارتفاع + عرض×ارتفاع)</p>
                    <p><strong>محيط القاعدة:</strong> 10 وحدات</p>
                    <p><strong>قانون المحيط:</strong> المحيط = 2(الطول + العرض) = 2(3 + 2) = 10</p>
                </div>
            </div>
            
            <div class="shape-info" id="cylinder-info">
                <h3>الأسطوانة</h3>
                <p>الأسطوانة شكل ثلاثي الأبعاد له 3 أوجه (قاعدتان دائريتان ووجه منحني)، حافتان دائريتان وبدون رؤوس</p>
                <p><strong>الأوجه:</strong> 3 | <strong>الحواف:</strong> 2 | <strong>الرؤوس:</strong> 0</p>
                <div class="math-formulas">
                    <p><strong>الحجم:</strong> 6.28 وحدات مكعبة</p>
                    <p><strong>قانون الحجم:</strong> الحجم = π × نق² × الارتفاع = π × 1² × 2 ≈ 6.28</p>
                    <p><strong>المساحة الكلية:</strong> 18.84 وحدة مربعة</p>
                    <p><strong>قانون المساحة:</strong> المساحة = 2π × نق × (نق + الارتفاع) = 2π × 1 × 3 ≈ 18.84</p>
                    <p><strong>محيط القاعدة:</strong> 6.28 وحدات</p>
                    <p><strong>قانون المحيط:</strong> المحيط = 2π × نق = 2π × 1 ≈ 6.28</p>
                </div>
            </div>
            
            <div class="shape-info" id="cone-info">
                <h3>المخروط</h3>
                <p>المخروط شكل ثلاثي الأبعاد له وجهان (قاعدة دائرية ووجه منحني)، حافة دائرية واحدة ورأس واحد</p>
                <p><strong>الأوجه:</strong> 2 | <strong>الحواف:</strong> 1 | <strong>الرؤوس:</strong> 1</p>
                <div class="math-formulas">
                    <p><strong>الحجم:</strong> 2.09 وحدات مكعبة</p>
                    <p><strong>قانون الحجم:</strong> الحجم = (1/3) × π × نق² × الارتفاع = (1/3) × π × 1² × 2 ≈ 2.09</p>
                    <p><strong>المساحة الكلية:</strong> 9.42 وحدة مربعة</p>
                    <p><strong>قانون المساحة:</strong> المساحة = π × نق × (نق + الراسم) حيث الراسم = √(نق² + ع²)</p>
                    <p><strong>محيط القاعدة:</strong> 6.28 وحدات</p>
                    <p><strong>قانون المحيط:</strong> المحيط = 2π × نق = 2π × 1 ≈ 6.28</p>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color faces"></div>
                    <span>الأوجه</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color edges"></div>
                    <span>الحواف</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color vertices"></div>
                    <span>الرؤوس</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // متغيرات عامة
        let scene, camera, renderer, currentShape = 'cube';
        let shapeGroup = new THREE.Group();
        let waterLevel = 0;
        let isWaterFilling = false;
        let isPerimeterVisible = false;
        let waterMesh = null;
        let perimeterLines = [];
        
        // متغيرات أبعاد الأشكال
        const shapeDimensions = {
            cube: { width: 2, height: 2, depth: 2 },
            box: { width: 3, height: 2, depth: 1.5 },
            cylinder: { radius: 1, height: 2 },
            cone: { radius: 1, height: 2 }
        };

        // بدء التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            console.log('صفحة محملة، بدء التطبيق...');
            init();
        });

        function init() {
            console.log('بدء إعداد Three.js...');
            
            // إنشاء المشهد
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222244);
            
            // إعداد الكاميرا
            const container = document.getElementById('canvas-container');
            const containerRect = container.getBoundingClientRect();
            camera = new THREE.PerspectiveCamera(75, containerRect.width / containerRect.height, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // إنشاء العرض
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(containerRect.width, containerRect.height);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // إضافة الإضاءة
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // إضافة مجموعة الأشكال إلى المشهد
            scene.add(shapeGroup);
            
            // إعداد معالجات الأحداث
            setupEventListeners();
            
            // إعداد التحكم بالماوس
            setupMouseControls();
            
            // تحميل الشكل الافتراضي
            createShape('cube');
            
            // بدء الرسم
            animate();
            
            console.log('تم إعداد Three.js بنجاح');
        }

        function setupEventListeners() {
            // معالجات أزرار الأشكال
            document.querySelectorAll('.shape-button').forEach(button => {
                button.addEventListener('click', function() {
                    // تحديث حالة الأزرار
                    document.querySelectorAll('.shape-button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // تحديث معلومات الشكل
                    document.querySelectorAll('.shape-info').forEach(info => info.classList.remove('active'));
                    const targetInfo = document.getElementById(this.dataset.shape + '-info');
                    if (targetInfo) {
                        targetInfo.classList.add('active');
                    }
                    
                    // إنشاء الشكل الجديد
                    createShape(this.dataset.shape);
                });
            });
            
            // معالج زر ملء الماء
            document.getElementById('fill-water').addEventListener('click', function() {
                this.classList.toggle('active');
                if (this.classList.contains('active')) {
                    startWaterFill();
                    this.textContent = 'إيقاف الملء';
                } else {
                    stopWaterFill();
                    this.textContent = 'ملء بالماء';
                }
            });
            
            // معالج زر إظهار المحيط
            document.getElementById('show-perimeter').addEventListener('click', function() {
                this.classList.toggle('active');
                isPerimeterVisible = this.classList.contains('active');
                if (isPerimeterVisible) {
                    showPerimeter();
                    this.textContent = 'إخفاء المحيط الكلي';
                } else {
                    hidePerimeter();
                    this.textContent = 'إظهار المحيط الكلي';
                }
            });
            
            // معالج زر إعادة التعيين
            document.getElementById('reset-view').addEventListener('click', function() {
                resetView();
            });
        }

        function createShape(shapeType) {
            console.log('إنشاء شكل:', shapeType);
            
            // مسح الشكل الحالي
            while(shapeGroup.children.length > 0) {
                shapeGroup.remove(shapeGroup.children[0]);
            }
            
            // إعادة تعيين المتغيرات
            resetVariables();
            currentShape = shapeType;
            
            switch(shapeType) {
                case 'cube':
                    createCube();
                    break;
                case 'box':
                    createBox();
                    break;
                case 'cylinder':
                    createCylinder();
                    break;
                case 'cone':
                    createCone();
                    break;
            }
            
            console.log('تم إنشاء الشكل:', shapeType);
        }

        function resetVariables() {
            waterLevel = 0;
            isWaterFilling = false;
            waterMesh = null;
            perimeterLines = [];
            
            // إعادة تعيين أزرار الميزات
            const fillBtn = document.getElementById('fill-water');
            const perimeterBtn = document.getElementById('show-perimeter');
            
            fillBtn.classList.remove('active');
            fillBtn.textContent = 'ملء بالماء';
            
            perimeterBtn.classList.remove('active');
            perimeterBtn.textContent = 'إظهار المحيط الكلي';
            
            isPerimeterVisible = false;
        }

        function createCube() {
            const geometry = new THREE.BoxGeometry(2, 2, 2);
            
            // إنشاء الأوجه
            const faceMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x808080, 
                transparent: true, 
                opacity: 0.3 
            });
            const faceMesh = new THREE.Mesh(geometry, faceMaterial);
            shapeGroup.add(faceMesh);
            
            // إنشاء الحواف
            const edges = new THREE.EdgesGeometry(geometry);
            const edgeMaterial = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 3 });
            const edgeMesh = new THREE.LineSegments(edges, edgeMaterial);
            shapeGroup.add(edgeMesh);
            
            // إنشاء الرؤوس
            const vertices = [
                [-1, -1, -1], [1, -1, -1], [1, 1, -1], [-1, 1, -1],
                [-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]
            ];
            
            vertices.forEach(vertex => {
                const vertexGeometry = new THREE.SphereGeometry(0.08, 8, 8);
                const vertexMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                const vertexMesh = new THREE.Mesh(vertexGeometry, vertexMaterial);
                vertexMesh.position.set(vertex[0], vertex[1], vertex[2]);
                shapeGroup.add(vertexMesh);
            });
        }
        
        function createBox() {
            const geometry = new THREE.BoxGeometry(3, 2, 1.5);
            
            // إنشاء الأوجه
            const faceMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x808080, 
                transparent: true, 
                opacity: 0.3 
            });
            const faceMesh = new THREE.Mesh(geometry, faceMaterial);
            shapeGroup.add(faceMesh);
            
            // إنشاء الحواف
            const edges = new THREE.EdgesGeometry(geometry);
            const edgeMaterial = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 3 });
            const edgeMesh = new THREE.LineSegments(edges, edgeMaterial);
            shapeGroup.add(edgeMesh);
            
            // إنشاء الرؤوس
            const vertices = [
                [-1.5, -1, -0.75], [1.5, -1, -0.75], [1.5, 1, -0.75], [-1.5, 1, -0.75],
                [-1.5, -1, 0.75], [1.5, -1, 0.75], [1.5, 1, 0.75], [-1.5, 1, 0.75]
            ];
            
            vertices.forEach(vertex => {
                const vertexGeometry = new THREE.SphereGeometry(0.08, 8, 8);
                const vertexMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                const vertexMesh = new THREE.Mesh(vertexGeometry, vertexMaterial);
                vertexMesh.position.set(vertex[0], vertex[1], vertex[2]);
                shapeGroup.add(vertexMesh);
            });
        }
        
        function createCylinder() {
            const geometry = new THREE.CylinderGeometry(1, 1, 2, 32);
            
            // إنشاء الأوجه
            const faceMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x808080, 
                transparent: true, 
                opacity: 0.3 
            });
            const faceMesh = new THREE.Mesh(geometry, faceMaterial);
            shapeGroup.add(faceMesh);
            
            // إنشاء الحواف (الدوائر العلوية والسفلية)
            const topCircle = new THREE.RingGeometry(0.98, 1.02, 32);
            const bottomCircle = new THREE.RingGeometry(0.98, 1.02, 32);
            
            const edgeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            
            const topEdge = new THREE.Mesh(topCircle, edgeMaterial);
            topEdge.position.y = 1;
            topEdge.rotation.x = Math.PI / 2;
            shapeGroup.add(topEdge);
            
            const bottomEdge = new THREE.Mesh(bottomCircle, edgeMaterial);
            bottomEdge.position.y = -1;
            bottomEdge.rotation.x = Math.PI / 2;
            shapeGroup.add(bottomEdge);
        }
        
        function createCone() {
            const geometry = new THREE.ConeGeometry(1, 2, 32);
            
            // إنشاء الأوجه
            const faceMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x808080, 
                transparent: true, 
                opacity: 0.3 
            });
            const faceMesh = new THREE.Mesh(geometry, faceMaterial);
            shapeGroup.add(faceMesh);
            
            // إنشاء الحافة (الدائرة السفلية)
            const bottomCircle = new THREE.RingGeometry(0.98, 1.02, 32);
            const edgeMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const bottomEdge = new THREE.Mesh(bottomCircle, edgeMaterial);
            bottomEdge.position.y = -1;
            bottomEdge.rotation.x = Math.PI / 2;
            shapeGroup.add(bottomEdge);
            
            // إنشاء الرأس
            const vertexGeometry = new THREE.SphereGeometry(0.08, 8, 8);
            const vertexMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
            const vertexMesh = new THREE.Mesh(vertexGeometry, vertexMaterial);
            vertexMesh.position.set(0, 1, 0);
            shapeGroup.add(vertexMesh);
        }

        function setupMouseControls() {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isMouseDown = false;
            });
            
            renderer.domElement.addEventListener('mousemove', (event) => {
                if (isMouseDown) {
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;
                    
                    shapeGroup.rotation.y += deltaX * 0.01;
                    shapeGroup.rotation.x += deltaY * 0.01;
                    
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                }
            });
            
            renderer.domElement.addEventListener('wheel', (event) => {
                camera.position.z += event.deltaY * 0.01;
                camera.position.z = Math.max(2, Math.min(10, camera.position.z));
            });
        }

        // دوال الماء والمحيط
        function startWaterFill() {
            waterLevel = 0;
            isWaterFilling = true;
            createWaterMesh();
        }
        
        function stopWaterFill() {
            isWaterFilling = false;
            if (waterMesh) {
                shapeGroup.remove(waterMesh);
                waterMesh = null;
            }
        }
        
        function createWaterMesh() {
            if (waterMesh) {
                shapeGroup.remove(waterMesh);
                if (waterMesh.geometry) {
                    waterMesh.geometry.dispose();
                }
            }
            
            let waterGeometry;
            const waterMaterial = new THREE.MeshLambertMaterial({
                color: 0x0077be,
                transparent: true,
                opacity: 0.7
            });
            
            const currentWaterLevel = Math.max(0.05, waterLevel);
            
            switch(currentShape) {
                case 'cube':
                    // ماء مكعب ضمن حدود المكعب
                    waterGeometry = new THREE.BoxGeometry(1.9, currentWaterLevel, 1.9);
                    break;
                    
                case 'box':
                    // ماء متوازي مستطيلات ضمن الحدود
                    waterGeometry = new THREE.BoxGeometry(2.9, currentWaterLevel, 1.4);
                    break;
                    
                case 'cylinder':
                    // ماء أسطواني ضمن الأسطوانة
                    waterGeometry = new THREE.CylinderGeometry(0.95, 0.95, currentWaterLevel, 32);
                    break;
                    
                case 'cone':
                    // ماء مخروطي - يتقلص كلما ارتفع
                    const coneHeight = shapeDimensions.cone.height;
                    const maxRadius = shapeDimensions.cone.radius;
                    const waterHeight = currentWaterLevel;
                    
                    // حساب نصف القطر في أعلى مستوى الماء
                    const topRadius = maxRadius * (1 - waterHeight / coneHeight);
                    const bottomRadius = maxRadius * 0.95; // قليلاً أصغر من المخروط
                    
                    waterGeometry = new THREE.CylinderGeometry(
                        Math.max(0.05, topRadius), 
                        bottomRadius, 
                        waterHeight, 
                        32
                    );
                    break;
            }
            
            waterMesh = new THREE.Mesh(waterGeometry, waterMaterial);
            
            // وضع الماء في الموضع الصحيح
            const shapeHeight = getShapeHeight();
            waterMesh.position.y = -shapeHeight/2 + currentWaterLevel/2;
            
            shapeGroup.add(waterMesh);
        }
        
        function updateWaterLevel() {
            if (!waterMesh) return;
            
            // إعادة إنشاء شبكة الماء بالحجم الجديد
            createWaterMesh();
        }
        
        function getShapeHeight() {
            switch(currentShape) {
                case 'cube': return shapeDimensions.cube.height;
                case 'box': return shapeDimensions.box.height;
                case 'cylinder': return shapeDimensions.cylinder.height;
                case 'cone': return shapeDimensions.cone.height;
                default: return 2;
            }
        }
        
        function showPerimeter() {
            hidePerimeter();
            
            const perimeterMaterial = new THREE.LineBasicMaterial({ 
                color: 0xffff00, 
                linewidth: 5 
            });
            
            switch(currentShape) {
                case 'cube':
                    showCubePerimeter(perimeterMaterial);
                    break;
                case 'box':
                    showBoxPerimeter(perimeterMaterial);
                    break;
                case 'cylinder':
                    showCylinderPerimeter(perimeterMaterial);
                    break;
                case 'cone':
                    showConePerimeter(perimeterMaterial);
                    break;
            }
        }
        
        function showCubePerimeter(material) {
            const size = 1;
            
            // القاعدة السفلية
            let points = [
                new THREE.Vector3(-size, -size, -size),
                new THREE.Vector3(size, -size, -size),
                new THREE.Vector3(size, -size, size),
                new THREE.Vector3(-size, -size, size),
                new THREE.Vector3(-size, -size, -size)
            ];
            addPerimeterLine(points, material);
            
            // القاعدة العلوية
            points = [
                new THREE.Vector3(-size, size, -size),
                new THREE.Vector3(size, size, -size),
                new THREE.Vector3(size, size, size),
                new THREE.Vector3(-size, size, size),
                new THREE.Vector3(-size, size, -size)
            ];
            addPerimeterLine(points, material);
            
            // الخطوط الجانبية العمودية
            const verticalLines = [
                [new THREE.Vector3(-size, -size, -size), new THREE.Vector3(-size, size, -size)],
                [new THREE.Vector3(size, -size, -size), new THREE.Vector3(size, size, -size)],
                [new THREE.Vector3(size, -size, size), new THREE.Vector3(size, size, size)],
                [new THREE.Vector3(-size, -size, size), new THREE.Vector3(-size, size, size)]
            ];
            
            verticalLines.forEach(line => addPerimeterLine(line, material));
        }
        
        function showBoxPerimeter(material) {
            const w = 1.5, h = 1, d = 0.75;
            
            // القاعدة السفلية
            let points = [
                new THREE.Vector3(-w, -h, -d),
                new THREE.Vector3(w, -h, -d),
                new THREE.Vector3(w, -h, d),
                new THREE.Vector3(-w, -h, d),
                new THREE.Vector3(-w, -h, -d)
            ];
            addPerimeterLine(points, material);
            
            // القاعدة العلوية
            points = [
                new THREE.Vector3(-w, h, -d),
                new THREE.Vector3(w, h, -d),
                new THREE.Vector3(w, h, d),
                new THREE.Vector3(-w, h, d),
                new THREE.Vector3(-w, h, -d)
            ];
            addPerimeterLine(points, material);
            
            // الخطوط الجانبية العمودية
            const verticalLines = [
                [new THREE.Vector3(-w, -h, -d), new THREE.Vector3(-w, h, -d)],
                [new THREE.Vector3(w, -h, -d), new THREE.Vector3(w, h, -d)],
                [new THREE.Vector3(w, -h, d), new THREE.Vector3(w, h, d)],
                [new THREE.Vector3(-w, -h, d), new THREE.Vector3(-w, h, d)]
            ];
            
            verticalLines.forEach(line => addPerimeterLine(line, material));
        }
        
        function showCylinderPerimeter(material) {
            const radius = 1;
            const height = 1;
            
            // الدائرة السفلية
            let points = [];
            for (let i = 0; i <= 64; i++) {
                const angle = (i / 64) * Math.PI * 2;
                points.push(new THREE.Vector3(
                    Math.cos(angle) * radius,
                    -height,
                    Math.sin(angle) * radius
                ));
            }
            addPerimeterLine(points, material);
            
            // الدائرة العلوية
            points = [];
            for (let i = 0; i <= 64; i++) {
                const angle = (i / 64) * Math.PI * 2;
                points.push(new THREE.Vector3(
                    Math.cos(angle) * radius,
                    height,
                    Math.sin(angle) * radius
                ));
            }
            addPerimeterLine(points, material);
            
            // الخطوط الجانبية العمودية (4 خطوط)
            for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                addPerimeterLine([
                    new THREE.Vector3(x, -height, z),
                    new THREE.Vector3(x, height, z)
                ], material);
            }
        }
        
        function showConePerimeter(material) {
            const radius = 1;
            const height = 1;
            
            // الدائرة السفلية (القاعدة)
            let points = [];
            for (let i = 0; i <= 64; i++) {
                const angle = (i / 64) * Math.PI * 2;
                points.push(new THREE.Vector3(
                    Math.cos(angle) * radius,
                    -height,
                    Math.sin(angle) * radius
                ));
            }
            addPerimeterLine(points, material);
            
            // الخطوط من القاعدة إلى القمة (8 خطوط)
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                addPerimeterLine([
                    new THREE.Vector3(x, -height, z),
                    new THREE.Vector3(0, height, 0)
                ], material);
            }
        }
        
        function addPerimeterLine(points, material) {
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            const line = new THREE.Line(geometry, material);
            perimeterLines.push(line);
            shapeGroup.add(line);
        }
        
        function hidePerimeter() {
            perimeterLines.forEach(line => {
                shapeGroup.remove(line);
                line.geometry.dispose();
            });
            perimeterLines = [];
        }
        
        function resetView() {
            stopWaterFill();
            hidePerimeter();
            
            const fillBtn = document.getElementById('fill-water');
            const perimeterBtn = document.getElementById('show-perimeter');
            
            fillBtn.classList.remove('active');
            fillBtn.textContent = 'ملء بالماء';
            
            perimeterBtn.classList.remove('active');
            perimeterBtn.textContent = 'إظهار المحيط';
            
            isPerimeterVisible = false;
            
            // إعادة تعيين موضع الكاميرا
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // إعادة تعيين دوران الشكل
            shapeGroup.rotation.set(0, 0, 0);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // دوران تلقائي بطيء
            shapeGroup.rotation.y += 0.005;
            
            // تحديث مستوى الماء إذا كان يتم ملؤه
            if (isWaterFilling && waterMesh) {
                const maxHeight = getShapeHeight();
                if (waterLevel < maxHeight * 0.95) { // التوقف قبل الوصول للقمة قليلاً
                    waterLevel += 0.03; // زيادة سرعة الملء قليلاً
                    updateWaterLevel();
                } else {
                    isWaterFilling = false;
                    // تغيير نص الزر عند اكتمال الملء
                    const fillBtn = document.getElementById('fill-water');
                    if (fillBtn && fillBtn.classList.contains('active')) {
                        fillBtn.textContent = 'إفراغ الماء';
                    }
                }
            }
            
            renderer.render(scene, camera);
        }

        // معالج تغيير حجم النافذة
        window.addEventListener('resize', () => {
            const container = document.getElementById('canvas-container');
            const containerRect = container.getBoundingClientRect();
            camera.aspect = containerRect.width / containerRect.height;
            camera.updateProjectionMatrix();
            renderer.setSize(containerRect.width, containerRect.height);
        });
    </script>
</body>
</html>
